$(function () {

    var tabloOdevListesi = $('#lstOdevler').DataTable({
        "pagingType": "simple",
        "language": {
            "url": ayarlar.datatablelangurl
        },
        "bPaginate": true,
        "bLengthChange": false,
        "bFilter": false,
        "bInfo": false,
        "bSort": false
    });


    $('input[name="SonTeslimTarihi"]').daterangepicker({
        singleDatePicker: true,
        showDropdowns: true,
        format: ayarlar.dtformat,
        drops: 'down',
        buttonClasses: ['btn', 'btn-sm'],
        applyClass: 'btn-primary',
        cancelClass: 'btn-default',
        locale: ayarlar.dtpickerlocale
    },
    function (start, end, label) {

    });

    $('#btnOdevVer').click(function () {

        var dosyadanTabSecili = $('#tabDosyalar').hasClass('active');

        if (dosyadanTabSecili) {
            $('#txtBilgisayardanDosya').val('');

        }
        else {
            $('#txtDosyalardanDosyaID').val('');
        }

        var odevBaslik = $('#txtOdevBaslik').val();

        if (odevBaslik == '') {
            $('#txtOdevBaslik').focus();
            HataMesaji(mesajlar.basliksecilmedi);
            return false;
        }
       
        $('#modalDerseOdevVer').modal('hide');
       
        $("#frmOdevEkle").ajaxSubmit({
            url: '/Ajax/Odev/OdevVer',
            dataType: "json",
            type: 'post',
            success: function (msg) {

                tabloOdevListesi.row.add([
                            '<i class="fa fa-clock-o fa-2x text-success"></i> ' + '<a href="/Odev/Goster?OdevID=' + msg.OdevID + '">' + msg.Baslik + '</a> ',
                           '<a href="/Odev/Goster?OdevID=' + msg.OdevID + '" class="btn btn-info" title="' + mesajlar.gozat +'"><i class="fa fa-search-plus"></i></a> ' +
                            '<a href="/Odev/Ayarlar?OdevID=' + msg.OdevID + '" class="btn btn-warning" title="' + mesajlar.odevayarlari +'"><i class="fa fa-cog"></i></a> ' +
                            '<a href="/Odev/OdevGonderileri?OdevID=' + msg.OdevID + '" class="btn btn-primary" title="' + mesajlar.odevinigonderenler +'"><i class="fa fa-user"></i></a> ' +
                            '<button class="btn btn-danger btnOdevSil" data-OdevID="' + msg.OdevID + '"><i class="fa fa-remove"></i></button> '

                        ]).draw();

                 
                MesajKutusu(mesajlar.islemtamam, mesajlar.odevbasariylaolusturuldu);
            },

            error: function () {
                 
                HataMesaji(mesajlar.odeveklenirkenhata);
            }

        });
       


    });

    $('body').on('click', '.btnOdevSil', function () {
        var OdevID = $(this).attr('data-OdevID');

        var row = tabloOdevListesi.row($(this).parents('tr'));
        if (confirm(mesajlar.odevsilinecek)) {

            $.ajax({
                type: 'POST',
                url: '/Ajax/Odev/OdevSil',
                data: "OdevID=" + OdevID,
                success: function (msg) {

                    row.remove().draw();
                },
                error: function (msg) {
                    HataMesaji(mesajlar.islemsirasindahata);
                }
            });
        }
    });


    var $dosyalar = $('#txtDosyalardanDosya').selectize({

        valueField: 'DosyaID',
        labelField: 'DosyaAdi',
        searchField: 'DosyaAdi',
        options: [],
        create: false,
        render: {
            option: function (item, escape) {

                return '<div class="media">' +
                            '<a class="pull-left" href="#">' +

                            '</a>' +

                            '<div class="media-body">' +
                                '<h5 class="media-heading"><strong>' + escape(item.Aciklama) + '</strong></h5>' +
                                '<small>' + escape(item.DosyaAdi) + '</small>' +

                            '</div>' +
                            '</div>';

            }
        },

        load: function (query, callback) {
            if (!query.length) return callback();
            
            $.ajax({
                url: '/Ajax/Dosya/JsonDosyaListesi.cshtml',
                data: {
                    sorgu: query
                },
                dataType: 'json',
                type: 'GET',
                error: function () {
                    
                     HataMesaji(mesajlar.islemsirasindahata);
                    callback();
                },
                success: function (res) {
                    
                    callback(res);
                }
            });
            
        },

        onItemAdd:
            function (data, $item) {
               
            }

    });
});