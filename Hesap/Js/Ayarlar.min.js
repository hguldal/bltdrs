$(document).ready(function () {

    $('#btnParolaDegistir').click(function () {


        var gecerliParola = $('#txtParola').val();
        var yeniParola = $('#txtYeniParola').val();
        var reYeniParola = $('#txtReYeniParola').val();

        if (gecerliParola == '') {
            HataMesaji(mesajlar.gecerliparolagirilmedi);
            $('#txtParola').focus();
            return false;
        }

        if (yeniParola == '') {
            HataMesaji(mesajlar.yeniparolagirilmedi);
            $('#txtYeniParola').focus();
            return false;
        }

        if (reYeniParola == '') {
            HataMesaji(mesajlar.yeniparolatekrargirilmedi);
            $('#txtReYeniParola').focus();
            return false;
        }


        if (yeniParola != reYeniParola) {
            HataMesaji(mesajlar.girilenparolalaruyusmadi);
            $('#txtYeniParola').focus();
            return false;
        }


        $.ajax({
            type: 'POST',
            url: '/Ajax/Hesap/ParolaDegistir',
            data: "Parola=" + encodeURIComponent(gecerliParola) + "&YeniParola=" + encodeURIComponent(yeniParola),
            success: function (msg) {

                if (msg == 'OK') {
                    MesajKutusu(mesajlar.islemtamam, mesajlar.parolabasariyladegistirildi);
                }
                else {
                    HataMesaji(mesajlar.paroladegistirmedehata);
                }
            },
            error: function (msg) {

                HataMesaji(mesajlar.paroladegistirmedehata);
            }
        });

    });

    $("#lnkGrupFotografSec").click(function () {

        $("#fileProfilFotografSec").click();

    });
    $('#cmbUniversiteler').val($('#cmbUniversiteler').attr('data-ilkdeger'));
    $('#cmbDil').val($('#cmbDil').attr('data-ilkdeger'));
    $('#cmbUnvanlar').val($('#cmbUnvanlar').attr('data-ilkdeger'));
    $("#fileProfilFotografSec").change(function () {

        var file = this.files[0];
        name = file.name;
        size = file.size;
        type = file.type;

        if (size > 3000000) {
            $("#fileProfilFotografSec").val('');
            HataMesaji(mesajlar.profilfotograficokbuyuk);
        }

        else if (file.type != 'image/png' && file.type != 'image/jpg' && !file.type != 'image/gif' && file.type != 'image/jpeg') {
            $("#fileProfilFotografSec").val('');
            HataMesaji(mesajlar.gecersizdosyaformati);
        }
        else {
            var reader = new FileReader();
            reader.onload = function (e) {
                if ($('#fileProfilFotografSec').val() != '') {

                    $('#imgProfilFoto').attr('src', e.target.result);
                }
                else {
                    HataMesaji(mesajlar.profilfotografisec);
                }

            }
            reader.readAsDataURL(file);

        }

    });


    $('#buttonProfilGuncelle').click(function () {

        d = new FormData();

        var ad = $('#txtAd').val();
        var soyad = $('#txtSoyad').val();
        var kurum = $('#cmbUniversiteler').val();
        var dil = $('#cmbDil').val();
        var unvan = $('#cmbUnvanlar').val();
        d.append('txtAd', ad);
        d.append('txtSoyad', soyad);
        d.append('cmbKurum', kurum);
        d.append('cmbDil', dil);
        d.append('cmbUnvan', unvan);

        if ($("#fileProfilFotografSec").val() != '') {
            var dosya = $('#fileProfilFotografSec')[0].files[0];
            d.append('file', dosya);
        }

        if ($('#imgProfilFoto').attr('src') == 'http://bulutders.blob.core.windows.net/profilresimleri/noimage.jpg') {
            d.append('fotoKaldir', "true");
        }

        if (ad == '') {
            HataMesaji(mesajlar.adveyasoyadgirilmedi);
        }

        //$('#buttonProfilGuncelle').block({ message: null });

        $.ajax({
            url: '/Ajax/Hesap/ProfilGuncelle.cshtml',
            data: d,
            
            contentType: false,
            processData: false,
            type: 'POST',
            success: function (data) {
               // $('#buttonProfilGuncelle').unblock(); 
                MesajKutusu(mesajlar.islemtamam, mesajlar.profilbilgileriguncellendi);
            },
            error: function (de) {
               //$('#buttonProfilGuncelle').unblock(); 
                HataMesaji(mesajlar.islemsirasindahatameydanageldi);

            }
        });

        

    });

    $('#btnProfilFotoKaldir').click(function () {

        $('#imgProfilFoto').attr('src', 'http://bulutders.blob.core.windows.net/profilresimleri/noimage.jpg');

    });
    $('#cmbUniversiteler').selectize();


});