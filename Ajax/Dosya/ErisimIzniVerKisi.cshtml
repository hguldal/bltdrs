@{
  if (!WebSecurity.IsAuthenticated)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  

    var DosyaID=Request["DosyaID"];
    var UserID=Request["UserID"];
    

    if (string.IsNullOrEmpty(DosyaID) || string.IsNullOrEmpty(UserID))
     {
    
       Response.StatusCode=500;
       Response.End();
     }

     var db=Database.Open("fb1ae");
 
     var queryDosya=db.QuerySingle("SELECT * FROM Dosya WHERE DosyaID=@0 AND UserID=@1",DosyaID,WebSecurity.CurrentUserId);

    if (WebSecurity.CurrentUserId!=queryDosya.UserID)
    {
        Response.StatusCode=400;
        Response.End();
    }

    if (UserID.AsInt()==WebSecurity.CurrentUserId)
    {
        db.Close();
        Response.Write("sahip");

        Response.End();
    }

    if (db.QueryValue("SELECT COUNT(*) FROM DosyaIzinKisi WHERE DosyaID=@0 AND UserID=@1",DosyaID,UserID)>0)
    {
        db.Close();
        Response.Write("zatenvar");

        Response.End();
    }
     db.Execute("INSERT INTO DosyaIzinKisi(DosyaID,UserID) VALUES(@0,@1)",DosyaID,UserID);

     db.Execute("INSERT INTO Bildirim(Url,EylemiYapanUserID,IliskiliOge,EylemID,DersID) VALUES(@0,@1,@2,@3,@4)","~/Dosya/BenimlePaylasilan",WebSecurity.CurrentUserId,"dsyeik" + UserID.ToString() + DosyaID.ToString(),7,-1);
     var eklenenBildirimID=db.GetLastInsertId();
     db.Execute("INSERT INTO BildirimOkunmasiGereken(UserID,BildirimID) VALUES(@0,@1)",UserID,eklenenBildirimID); 
       

     db.Close();
     Response.Write("OK");
     Response.End();
     
    
     }
