@{
  if (!WebSecurity.IsAuthenticated)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  

    var Ogeler=Request["Ogeler"];
    var HedefID=Request["HedefID"];
    
    
    if (string.IsNullOrEmpty(Ogeler))
     {
    
       Response.StatusCode=500;
       Response.End();
     }
    string[] tasinacakOgeler = Ogeler.Split(',');
    
    var db=Database.Open("fb1ae");

    foreach (var tasinacakOge in tasinacakOgeler)
    {
      
      var ogeTur=tasinacakOge.Substring(0,2);
    
    if (ogeTur=="d_")
     {
         var tmpTasinacakOge=tasinacakOge.Replace("d_",""); 
         var queryDosya=db.QuerySingle("SELECT * FROM Dosya WHERE DosyaID=@0 AND UserID=@1",tmpTasinacakOge,WebSecurity.CurrentUserId);
         if (queryDosya==null)
         {
             Response.StatusCode=501;
             db.Close();
             Response.End();
         }

         db.Execute("UPDATE Dosya SET Konum=@0 WHERE DosyaID=@1 AND UserID=@2",HedefID, tmpTasinacakOge,WebSecurity.CurrentUserId);
     }
     else if (ogeTur=="k_")
     {
        var tmpTasinacakOge=tasinacakOge.Replace("k_",""); 
        var queryKlasor=db.QuerySingle("SELECT * FROM Klasor WHERE KlasorID=@0 AND UserID=@1",tmpTasinacakOge,WebSecurity.CurrentUserId);
         if (queryKlasor==null)
         {
             Response.StatusCode=501;
             db.Close();
             Response.End();
         }
         if (Convert.ToString(queryKlasor.KlasorID)!=HedefID)
         {
            db.Execute("UPDATE Klasor SET Konum=@0 WHERE KlasorID=@1 AND UserID=@2",HedefID,tmpTasinacakOge,WebSecurity.CurrentUserId);
         }
     }
        
    }

     

     db.Close();
     Response.Write("OK");
     Response.End();
     
    
}
