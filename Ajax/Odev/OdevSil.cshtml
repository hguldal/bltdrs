@{
    if (WebSecurity.IsAuthenticated==false || Roles.IsUserInRole("Ogretici")==false)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  

    var OdevID=Request["OdevID"];
    

    if (string.IsNullOrEmpty(OdevID))
     {
    
       Response.StatusCode=500;
       Response.End();
     }


     var db=Database.Open("fb1ae");
 
     var queryOdev=db.QuerySingle("SELECT * FROM Odev WHERE OdevID=@0",OdevID);
     var queryDers=db.QuerySingle("SELECT * FROM Ders WHERE DersID=@0",queryOdev.DersID);
   

    if (WebSecurity.CurrentUserId==queryDers.UserID)
    {
       
        db.Execute("UPDATE Odev SET Silindi=1 WHERE OdevID=@0",OdevID);
        db.Execute("UPDATE OdevGonderisi SET Silindi=1 WHERE OdevID=@0",OdevID);
        db.Execute("UPDATE Dosya SET Silindi=1 WHERE DosyaID IN (SELECT DosyaID FROM OdevGonderisi WHERE OdevID=@0)",OdevID);
        db.Execute("UPDATE Aktivite SET Silindi=1 WHERE IliskiliOge=@0","odvver" + OdevID.ToString());
        db.Execute("UPDATE Bildirim SET Silindi=1 WHERE IliskiliOge=@0","odvver" + OdevID.ToString());
        db.Execute("UPDATE Gorev SET Silindi=1 WHERE IliskiliOge=@0","odvver" + OdevID.ToString());
        db.Close();
        Response.Write("OK");
        Response.End();
    }
    else
    {
        Response.StatusCode=400;
        Response.End();
    }
    
}



