@{
    // Bu prosedürü sadece oturumu açmış ve dersin sahibi olan kullanıcı çalıştırabilir.
  if (WebSecurity.IsAuthenticated==false || Roles.IsUserInRole("Ogretici")==false) 
        {
            Response.StatusCode=401;
            Response.End();
        }  

    // Gelen değerleri oku (Gelen değerler: Veritabanı tablosundaki alanın adı,değeri ve değiştirelecek olan satırın ID si)
    var DersID=Request["DersID"];
  
    if (string.IsNullOrEmpty(DersID))
     {
    
       Response.StatusCode=500;
       Response.End();
     }

    var db=Database.Open("fb1ae");
 
    // Ders bilgilerini veritabanından oku.
    var queryDers=db.QuerySingle("SELECT * FROM Ders WHERE DersID=@0 AND UserID=@1",DersID,WebSecurity.CurrentUserId);

    // Eğer kullanıcı dersin sahibi değilse bu işlemi yapmaya izni yok hata kodu döndür.
    if (WebSecurity.CurrentUserId!=queryDers.UserID)
    {
        db.Close();
        Response.StatusCode=400;
        Response.End();
    }  

    db.Execute("UPDATE Ders SET Silindi=1 WHERE DersID=@0",DersID);
    db.Execute("UPDATE Aktivite SET Silindi=1 WHERE DersID=@0",DersID);
    db.Execute("UPDATE Bildirim SET Silindi=1 WHERE DersID=@0",DersID);
    db.Execute("UPDATE Odev SET Silindi=1 WHERE DersID=@0",DersID);
    db.Execute("UPDATE DersPano SET Silindi=1 WHERE DersID=@0",DersID);

    db.Close();
    Response.Write("OK");
    Response.End();
}

