@{
    
/*----------------------------------------------------------------------------------
    Bu prosedür ders panosundan bir mesaj siler.
    Bu prosedürü sadece dersin sahibi ve mesajın sahibi çalıştırabilir.
  ---------------------------------------------------------------------------------*/
    if (!WebSecurity.IsAuthenticated)
   
        {
            Response.StatusCode=401;
            Response.End();
                   
        }  

    // Mesaj ID sini oku
    var ID=Request["ID"];
    
    // MesajID boşsa hta kodu döndür.
    if (string.IsNullOrEmpty(ID))
     {
    
       Response.StatusCode=500;
       Response.End();
     }


     var db=Database.Open("fb1ae");

     //Mesaj bilgilerini veritabanından oku
     var queryPanoOgesi=db.QuerySingle("SELECT * FROM DersPano WHERE ID=@0",ID);
     // Ders bilgilerini veritabanından oku
     var queryDers=db.QuerySingle("SELECT * FROM Ders WHERE DersID=@0",queryPanoOgesi.DersID);
   
    // İşlemi yapan kullanıcı dersin sahibi veya mesajın sahibi mi kontrol et eğer öyleyse mesajı veritabanından sil.
    if (WebSecurity.CurrentUserId==queryDers.UserID || WebSecurity.CurrentUserId==queryPanoOgesi.PaylasanUserID)
    {
        db.Execute("UPDATE DersPano SET Silindi=1 WHERE ID=@0",ID);
        db.Execute("UPDATE Bildirim SET Silindi=1 WHERE IliskiliOge=@0","drspno" + ID.ToString());
        db.Execute("UPDATE Aktivite SET Silindi=1 WHERE IliskiliOge=@0","drspno" + ID.ToString());
        
        db.Close();
        Response.Write("OK");
        Response.End();
    }
    else
    {
        Response.StatusCode=400;
        Response.End();
    }
    
}



