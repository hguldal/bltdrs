       var maxBlockSize = 1 * 1024 * 1024;
       var numberOfBlocks = 1;
       var selectedFile = null;
       var currentFilePointer = 0;
       var totalBytesRemaining = 0;
       var blockIds = new Array();
       var blockIdPrefix = "block-";
       var submitUri = null;
       var bytesUploaded = 0;
       var yVarmi = true;
       var azureDosyaAdi = '';

function DegiskenleriSifirla()
{
    selectedFile = null;
    currentFilePointer = 0;
    totalBytesRemaining = 0;
    blockIds = [];
    submitUri = null;
    bytesUploaded = 0;
    yVarmi = true;
    azureDosyaAdi = '';
    $('#uploadProgress').attr('value', 0);
}

   $("#txtDosya").change(function () {
           var file = this.files[0];
           name = file.name;
           size = file.size;
           type = file.type;

           if (size > 200000000) {
               $("#txtDosya").val('');
               HataMesaji(mesajlar.dosyaboyutubuyuk);
           }
           else {
              
               $.ajax({
                   type: 'POST',
                   url: '/Ajax/Dosya/Yervarmi',
                   data: "DosyaBoyut=" + size,
                   success: function (msg) {
                       
                       yVarmi = true;
                   },
                   error: function (msg) {
                        
                       if (msg.status == 502) {
                           $("#txtDosya").val('');
                           yVarmi = false;
                           HataMesaji(mesajlar.dosyaicinyetersizalan);
                       }
                       else {
                           HataMesaji(mesajlar.dosyaeklenirkenhata);
                       }
                   }
               });
              
           }

       });

       $('#btnDosyaEkle').click(function () {

           var file = $('#txtDosya')[0].files[0];

           if (file == null) {
               $('#txtDosya').focus();
               HataMesaji(mesajlar.dosyasecilmedi);
               return false;
           }
           $('#modalDosyaEkle').modal('hide');
           handleFileSelect();
           ajaxUIBlock = false;
           UIBlockProgress();
           $.ajax({
               type: 'GET',
               url: '/Ajax/Dosya/YeniGuid',
               success: function (res) {

                   azureDosyaAdi = res + '.' + selectedFile.name.substr(selectedFile.name.lastIndexOf('.') + 1);


                   $.ajax({
                       type: 'GET',
                       url: '/Ajax/Dosya/AzureSaSOlustur?AzureDosyaAdi=' + azureDosyaAdi,

                       success: function (res) {
                           submitUri = res;
                           uploadFileInBlocks();

                       },
                       error: function (res, status, xhr) {
                           HataMesaji("Microsoft Azure: Can't get the Shared Access Signature");
                       }
                   });

               },
               error: function (res) {
                   HataMesaji(mesajlar.dosyaeklenirkenhata);
                   return false;
               }
           });

       });

   function handleFileSelect() {
           maxBlockSize = 1 * 1024 * 1024;
           currentFilePointer = 0;
           totalBytesRemaining = 0;

           selectedFile = $('#txtDosya')[0].files[0];

           var fileSize = selectedFile.size;
           if (fileSize < maxBlockSize) {
               maxBlockSize = fileSize;

           }
           totalBytesRemaining = fileSize;
           if (fileSize % maxBlockSize == 0) {
               numberOfBlocks = fileSize / maxBlockSize;
           } else {
               numberOfBlocks = parseInt(fileSize / maxBlockSize, 10) + 1;
           }

       }

   var reader = new FileReader();

   reader.onloadend = function (evt) {
           if (evt.target.readyState == FileReader.DONE) {
               var uri = submitUri + '&comp=block&blockid=' + blockIds[blockIds.length - 1];
               var requestData = new Uint8Array(evt.target.result);
               $.ajax({
                   url: uri,
                   type: "PUT",
                   data: requestData,
                   processData: false,
                   beforeSend: function (xhr) {
                       xhr.setRequestHeader('x-ms-blob-type', 'BlockBlob');

                   },
                   success: function (data, status) {
                       bytesUploaded += requestData.length;
                       var percentComplete = ((parseFloat(bytesUploaded) / parseFloat(selectedFile.size)) * 100).toFixed(1);
                       $('#uploadProgress').attr('value', percentComplete);

                       uploadFileInBlocks();
                   },
                   error: function (xhr, desc, err) {
                       HataMesaji(desc);
                   }
               });
           }
       };

    function uploadFileInBlocks() {
           if (totalBytesRemaining > 0) {

               var fileContent = selectedFile.slice(currentFilePointer, currentFilePointer + maxBlockSize);
               var blockId = blockIdPrefix + pad(blockIds.length, 6);

               blockIds.push(btoa(blockId));
               reader.readAsArrayBuffer(fileContent);
               currentFilePointer += maxBlockSize;
               totalBytesRemaining -= maxBlockSize;
               if (totalBytesRemaining < maxBlockSize) {
                   maxBlockSize = totalBytesRemaining;
               }
           } else {
               commitBlockList();
           }
       }

    function commitBlockList() {
           var uri = submitUri + '&comp=blocklist';

           var requestBody = '<?xml version="1.0" encoding="utf-8"?><BlockList>';
           for (var i = 0; i < blockIds.length; i++) {
               requestBody += '<Latest>' + blockIds[i] + '</Latest>';
           }
           requestBody += '</BlockList>';

           $.ajax({
               url: uri,
               type: "PUT",
               data: requestBody,
               beforeSend: function (xhr) {
                   xhr.setRequestHeader('x-ms-blob-content-type', selectedFile.type);

               },
               success: function (data, status) {
    
                   var aciklama = $('#txtAciklama').val();
                   var konum = $('#spnKonum').attr('data-Konum');
                   DosyayiVeritabaninaKaydet(selectedFile.name, selectedFile.size, selectedFile.type, azureDosyaAdi,aciklama,konum);
                   
                   
               },
               error: function (xhr, desc, err) {
                   console.log(desc);
                   console.log(err);
                   HataMesaji(mesajlar.dosyaeklenirkenhata + ' ' + desc);
               }
           });

       }
    
    function pad(number, length) {
           var str = '' + number;
           while (str.length < length) {
               str = '0' + str;
           }
           return str;
       }

    function DosyayiVeritabaninaKaydet(dosyaAdi, dosyaBoyut, dosyaTuru, azureDosyaAdi, aciklama,konum) {

           var satir = $('.KlasorSatiri').last();
           $.ajax({
               type: 'POST',
               dataType: 'json',
               url: '/Ajax/Dosya/Ekle?AzureDosyaAdi=' + azureDosyaAdi + '&Aciklama=' + encodeURIComponent(aciklama) + '&DosyaBoyut=' + dosyaBoyut + '&DosyaAdi=' + encodeURIComponent(dosyaAdi) + '&DosyaTuru=' + dosyaTuru + '&Konum=' + konum,
               success: function (msg) {

                   var boyut = "";
                   if (msg.Boyut < 1048576) {
                       boyut = Math.round(msg.Boyut / 1024) + ' KB';
                   }
                   else {
                       boyut = Math.round(msg.Boyut / 1048576) + ' MB';
                   }

                   var eklenecekHtml = '';

                   eklenecekHtml = '<tr class="DosyaSatiri">' +
                   '<td class="col-md-1 text-center">' +
                   '<label>' +
                   '<input type="checkbox" class="colored-primary chkBoxOge"  data-OgeID="d_' + msg.DosyaID + '">' +
                   '<span class="text"></span>' +
                   '</label>' +
                   '</td>' +
                   '<td><a href="/Dosya/Indir?DosyaID=' + msg.DosyaID + '"><i class="fa fa-file-text-o fa-2x"></i> ' + msg.DosyaAdi + '</a></td>' +

                   '<td>' +

                   '<div class="dropdown">' +


                   '<button id="dLabel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-primary btn-xs">' +
                   '<i class="fa fa-cog"></i>' +
                   '<span class="caret"></span>' +
                   '</button>' +

                   '<ul class="dropdown-menu" aria-labelledby="dLabel">' +
                   '<li><a href="/Dosya/Indir?DosyaID=' + msg.DosyaID + '"><i class="fa fa-cloud-download"></i> Karşıdan Yükle</a></li>' +
                   '<li><a href="/Dosya/Ayarlar?DosyaID=' + msg.DosyaID + '"><i class="fa fa-cog"></i> Ayarlar</a></li>' +
                   '<li><a href="/Dosya/Indirenler?DosyaID=' + msg.DosyaID + '"><i class="fa fa-arrow-circle-o-down"></i> Dosyayı Yükleyen Kullanıcılar</a></li>' +
                   '<li><a href="#" class="btnOgeSil" data-OgeID="d_' + msg.DosyaID + '"><i class="fa fa-remove"></i> Sil</a></li>' +
                   '</ul>' +
                   '</div>' +

                   '</td>' +
                   '<td></td>' +
                   '<td>' +

                   boyut.toString() +
                   '</td>' +



                   '<td>Az Önce</td>' +


                   '</tr>';
                   if (satir != undefined) {
                       satir.after(eklenecekHtml);
                   }
                   else {
                       $('#lstDosyalar>tbody').append(eklenecekHtml);
                   }

                   MesajKutusu(mesajlar.islemtamam, mesajlar.dosyabasariylaeklendi);
                   $('#txtDosya').val('');
                   DegiskenleriSifirla();
                   UIUnBlock();
                   ajaxUIBlock = true;

               },
               error: function (res) {

                   HataMesaji(mesajlar.dosyaeklenirkenhata);

               }
           });

       }

       $('body').on('click', '.btnDosyaSil', function () {
           var DosyaID = $(this).attr('data-DosyaID');
           var dugme = $(this);
           console.log(DosyaID);
           if (confirm(mesajlar.dosyasilinecek)) {
               $.ajax({
                   type: 'POST',
                   url: '/Ajax/Dosya/Sil',
                   data: "DosyaID=" + DosyaID,
                   success: function (msg) {

                       MesajKutusu(mesajlar.islemtamam, 'Dosya Silindi');
                   },
                   error: function (msg) {
                       HataMesaji(mesajlar.islemsirasindahata);
                   }
               });
           }
       });

    $('#btnKlasorOlustur').click(function () {

        var klasorAdi = $('#txtKlasorAdi').val();
        var konum = $('#spnKonum').attr('data-Konum');

        satir = $('.KlasorSatiri').last();

        $.ajax({
            type: 'POST',
            url: '/Ajax/Dosya/KlasorOlustur',
            data: 'Konum=' + konum + '&KlasorAdi=' + klasorAdi,
            success: function (res) {
                var html = '';

                html = '<tr class="KlasorSatiri warning">' +
                '<td class="col-md-1 text-center">' +
                '<label>' +
                '<input type="checkbox" data-OgeID="k_' + res + '" class="colored-primary chkBoxOge" checked="true">' +
                '<span class="text"></span>' +
                '</label>' +
                '</td>' +
                '<td>' +
                '<a href="/Dosya/Liste?Konum=' + res + '"><i class="fa fa-folder fa-2x"></i> ' + klasorAdi + '</a>' +
                '</td>' +
                '<td>' +

                '<div class="dropdown">' +
                 '<button id="dLabel" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-primary btn-xs">' +
                '<i class="fa fa-cog"></i>' +
                '<span class="caret"></span>' +
                '</button>' +

                '<ul class="dropdown-menu" aria-labelledby="dLabel">' +
                '<li><a href="#" class="btnOgeSil" data-OgeID="k_' + res + '"><i class="fa fa-remove"></i> Sil</a></li>' +

                '</ul>' +
                '</div>' +

                '</td>' +
                '<td></td>' +
                '<td>--</td>' +


                '<td>Az Önce</td>' +


                '</tr>';

                satir.after(html);

                $('#btnKlasoreTasiModalAc').prop('disabled', false);
                $('#btnCokluSil').prop('disabled', false);

                $('#modalKlasorEkle').modal('hide');
                $('#txtKlasorAdi').val('');

            },
            error: function (res) {
                HataMesaji('Klasor Olusturulurken bir hata meydana geldi');
                return false;
            }
        });

    });

    $('body').on('click', '.chkBoxOge', function () {
        var satir = $(this).closest("tr");

        if (this.checked) {

            $(satir).addClass("warning");
            $('#btnKlasoreTasiModalAc').prop('disabled', false);
            $('#btnCokluSil').prop('disabled', false);

        }
        else {
            $(satir).removeClass("warning");
            var seciliOgeSayisi = 0;
            $('.chkBoxOge').each(function () {
                if (this.checked) {
                    seciliOgeSayisi++;
                }

            });
            if (seciliOgeSayisi == 0) {
                $('#btnKlasoreTasiModalAc').prop('disabled', true);
                $('#btnCokluSil').prop('disabled', true);
            }

        }

    });

    $('body').on('click', '.btnOgeSil', function () {
        var satir = $(this).closest("tr");
        var ogeID = $(this).attr('data-OgeID');
        if (confirm('Seçili öğe kalıcı olarak silinecek emin misiniz ?')) {
            $.ajax({
                type: 'POST',
                url: '/Ajax/Dosya/OgeSil',
                data: 'OgeID=' + ogeID,
                success: function (res) {
                    $(satir).animate({ backgroundColor: 'gray' }, 150).fadeOut(150, function () {
                        $(satir).remove()
                    });

                },
                error: function (res) {
                    HataMesaji('Öğe silinirken bir hata meydana geldi');
                    return false;
                }
            });
        }
    });

    $('body').on('click', '#btnCokluSil', function () {
        var silecekOgeler = '';
        console.log('aa');
        $('.chkBoxOge').each(function () {
            if (this.checked) {
                silecekOgeler = silecekOgeler + $(this).attr("data-OgeID") + ",";
            }

        });
        silecekOgeler = silecekOgeler.substring(0, silecekOgeler.length - 1)
        if (silecekOgeler != "") {
            if (confirm('Seçili öğeler kalıcı olarak silinecek. Emin misiniz ?')) {
                $.ajax({
                    type: 'POST',
                    url: '/Ajax/Dosya/OgeSil',
                    data: {
                        OgeID: silecekOgeler
                    },
                    success: function (res) {
                        $('.chkBoxOge').each(function () {
                            if (this.checked) {
                                var satir = $(this).closest('tr');

                                $(satir).remove()

                            }
                        });



                    },
                    error: function (res) {
                        HataMesaji('Öğe silinirken bir hata meydana geldi');
                        return false;
                    }
                });
            }

        }

    });

    $('body').on('change', '.chkBoxKlasorSecOge', function () {
        var secili = this.checked;
        if (secili) {
            $('.chkBoxKlasorSecOge').each(function () {
                var satir = $(this).closest("tr");
                $(satir).removeClass("warning");
                this.checked = false;

            });
        }
        this.checked = secili;
        var satir = $(this).closest("tr");
        if (secili) {
            $(satir).addClass("warning");
        }
        else {
            $(satir).removeClass("warning");
        }
    });

    $('body').on('click', '.lnkKlasorSecOge', function () {

        var KlasorID = $(this).attr('data-KlasorID');

        KlasorleriGoster(KlasorID);

    });

    $('#modalKlasorSec').on('shown.bs.modal', function (e) {
         ajaxUIBlock = false;
        KlasorleriGoster(-1);
    });

    $('#modalKlasorSec').on('hidden.bs.modal', function (e) {
        ajaxUIBlock = true;
       
    });

    $('#modalKlasorEkle').on('shown.bs.modal', function (e) {
        $('#txtKlasorAdi').focus();
    });

    function KlasorleriGoster(KlasorID)
    {
        $('#spinnerIcon').removeClass('hide');
        $('#tableKlasorSecKlasorListesi').addClass('hide');
        $.ajax({
            url: '/Ajax/Dosya/JsonAltKlasorler.cshtml',
            data: 'Konum=' + KlasorID,
            dataType: 'json',
            type: 'GET',
            error: function (hata) {
                return false;

            },
            success: function (res) {

                $('#tableKlasorSecKlasorListesi').empty();

                if (res.UstKlasor != -2) {

                    $('#tableKlasorSecKlasorListesi').prepend('<tr><td></td><td><button class="btn btn-link lnkKlasorSecOge" data-KlasorID="' + res.UstKlasor + '"><i class="fa fa-arrow-circle-up fa-2x"></i> Bir Üst Konum</button></td></tr>');
                }
                for (var i = 0; i < res.AltKlasorler.length; i++) {

                    var eklenecekHtml = '';
                    eklenecekHtml = '<tr>' +
                '<td class="col-md-1 text-center">' +
                '<label>' +
                '<input type="checkbox" data-KlasorID="' + res.AltKlasorler[i].KlasorID + '" class="colored-primary chkBoxKlasorSecOge">' +
                '<span class="text"></span>' +
                '</label>' +
                '</td>' +
                '<td>' +
                '<button class="btn btn-link lnkKlasorSecOge" data-KlasorID="' + res.AltKlasorler[i].KlasorID + '"><i class="fa fa-folder fa-2x"></i>' + res.AltKlasorler[i].KlasorAdi + '</button>' +
                '</td>' +

                '</tr>';
                    $('#tableKlasorSecKlasorListesi').append(eklenecekHtml);
                   
                }
             $('#spinnerIcon').addClass('hide');
             $('#tableKlasorSecKlasorListesi').removeClass('hide');
            }
        }); 
    }

    $('#btnKlasoreTasi').click(function () {

        var tasinacakOgeler = '';
        var HedefID = $('.chkBoxKlasorSecOge:checked').attr('data-KlasorID');
        $('.chkBoxOge').each(function () {
            if (this.checked) {
                tasinacakOgeler = tasinacakOgeler + $(this).attr("data-OgeID") + ",";
            }

        });
        tasinacakOgeler = tasinacakOgeler.substring(0, tasinacakOgeler.length - 1)

        if (tasinacakOgeler == "") {
            HataMesaji('Lütfen taşınmasını istediğiniz öğeleri seçin');
            return false;
        }

        if (HedefID == null) {
            HataMesaji('Lütfen taşınmasını istediğiniz konumu seçin');
            return false;
        }

        console.log(tasinacakOgeler);
        console.log(HedefID);

        $.ajax({
            type: 'POST',
            url: '/Ajax/Dosya/OgeTasi',
            data: {
                Ogeler: tasinacakOgeler,
                HedefID: HedefID
            },
            success: function (res) {
                $('.chkBoxOge').each(function () {
                    if (this.checked) {
                        var satir = $(this).closest('tr');

                        $(satir).remove()

                    }
                });

                $('#modalKlasorSec').modal('hide');

            },
            error: function (res) {
                HataMesaji('Öğe taşınırken bir hata meydana geldi');
                return false;
            }
        });



    });