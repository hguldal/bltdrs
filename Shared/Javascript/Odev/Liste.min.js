$(function () {

 
    $('#cmbDersID').selectize();


    $('input[name="SonTeslimTarihi"]').daterangepicker({
        singleDatePicker: true,
        showDropdowns: true,
        format: ayarlar.dtformat,
        drops: 'down',
        buttonClasses: ['btn', 'btn-sm'],
        applyClass: 'btn-primary',
        cancelClass: 'btn-default',
        locale: ayarlar.dtpickerlocale
    },
    function (start, end, label) {

    });

    $("#txtBilgisayardanDosya").change(function () {

        var file = this.files[0];
        name = file.name;
        size = file.size;
        type = file.type;

        if (size > 200000000) {
            $("#txtBilgisayardanDosya").val('');
            HataMesaji(mesajlar.dosyaboyutubuyuk);
        }
        else {
            $.ajax({
                type: 'POST',
                url: '/Ajax/Dosya/Yervarmi',
                data: "DosyaBoyut=" + size,

                error: function (msg) {
                    if (msg.status == 502) {
                        $("#txtBilgisayardanDosya").val('');
                        HataMesaji(mesajlar.yetersizdepolamaalani);
                    }
                }
            });
        }

    });

    $('#btnOdevVer').click(function () {

        var dosyadanTabSecili = $('#tabDosyalar').hasClass('active');

        if (dosyadanTabSecili) {
            $('#txtBilgisayardanDosya').val('');

        }
        else {
            $('#cmbDosyalardanDosya').val('');
        }

        var odevBaslik = $('#txtOdevBaslik').val();
        var DersID = $('#cmbDersID').val(); ;

        if (DersID == '') {
            $('#cmbDersID').focus();
            HataMesaji(mesajlar.derssecilmedi);
            return false;
        }

        if (odevBaslik == '') {
            $('#txtOdevBaslik').focus();
            HataMesaji(mesajlar.basliksecilmedi);
            return false;
        }


        $('#modalYeniOdevVer').modal('hide');

       
        $("#frmOdevEkle").ajaxSubmit({
            url: '/Ajax/Odev/OdevVer',
            dataType: "json",
            type: 'post',
            success: function (msg) {

                lstOdevler.row.add([
                            '<i class="fa fa-clock-o fa-2x text-success"></i> <a href="/Ders?DersID=' + msg.DersID + '"> ' + msg.DersAdi + '</a>',
                            '<a href="/Odev/Goster?OdevID=' + msg.OdevID + '">' + msg.Baslik + '</a> ',
                            '<a href="/Odev/Goster?OdevID=' + msg.OdevID + '" class="btn btn-info" title="' + mesajlar.gozat +'"><i class="fa fa-search-plus"></i></a> ' +
                            '<a href="/Odev/Ayarlar?OdevID=' + msg.OdevID + '" class="btn btn-warning" title="' + mesajlar.odevayarlari +'"><i class="fa fa-cog"></i></a> ' +
                            '<a href="/Odev/OdevGonderileri?OdevID=' + msg.OdevID + '" class="btn btn-primary" title="' + mesajlar.odevinigonderenler +'"><i class="fa fa-user"></i></a> ' +
                            '<button class="btn btn-danger btnOdevSil" data-OdevID="' + msg.OdevID + '"><i class="fa fa-remove"></i></button> '

                        ]).draw();
                
                MesajKutusu(mesajlar.islemtamam, mesajlar.odevbasariylaeklendi);
            },

            error: function (msg) {
                 
                if (msg.status == 502) {
                    HataMesaji(mesajlar.yetersizdepolamaalani);
                }
                else {
                    HataMesaji(mesajlar.verilmesirasindabirhataolustu);
                }
            }

        });
       


    });

    $('body').on('click', '.btnOdevSil', function () {
        var OdevID = $(this).attr('data-OdevID');

        var row = lstOdevler.row($(this).parents('tr'));
        if (confirm(mesajlar.odevsilinecek)) {

            $.ajax({
                type: 'POST',
                url: '/Ajax/Odev/OdevSil',
                data: "OdevID=" + OdevID,
                success: function (msg) {

                    row.remove().draw();
                },
                error: function (msg) {
                    HataMesaji(mesajlar.islemsirasindabirhataolustu);
                }
            });
        }
    });

    var $dosyalar = $('#cmbDosyalardanDosya').selectize({

        valueField: 'DosyaID',
        labelField: 'DosyaAdi',
        searchField: 'DosyaAdi',
        options: [],
        create: false,
        render: {
            option: function (item, escape) {

                return '<div class="media">' +
                            '<a class="pull-left" href="#">' +

                            '</a>' +

                            '<div class="media-body">' +
                                '<h5 class="media-heading"><strong>' + escape(item.Aciklama) + '</strong></h5>' +
                                '<small>' + escape(item.DosyaAdi) + '</small>' +

                            '</div>' +
                            '</div>';

            }
        },

        load: function (query, callback) {
            if (!query.length) return callback();
           
            $.ajax({
                url: '/Ajax/Dosya/JsonDosyaListesi.cshtml',
                data: {
                    sorgu: query
                },
                dataType: 'json',
                type: 'GET',
                error: function () {
                     
                    alert(mesajlar.islemsirasindabirhataolustu);
                    callback();
                },
                success: function (res) {
                     
                    callback(res);
                }
            });
           
        },

        onItemAdd:
            function (data, $item) {


            }

    });
});