$(document).ready(function () {
    var onayliOgrencilerTablosu = $('#lstOnayliOgrenciler').DataTable({
        "pagingType": "simple",
        "language": {
            "url": ayarlar.datatablelangurl
        }
    });

    $('#cmbKabulSekli').val($('#cmbKabulSekli').attr('data-ilkdeger'));
    $('#cmbAramalardaGoster').val($('#cmbAramalardaGoster').attr('data-ilkdeger'));
    $('#cmbHaftalikSaat').val($('#cmbHaftalikSaat').attr('data-ilkdeger'));
    $('#cmbArsivlendi').val($('#cmbArsivlendi').attr('data-ilkdeger'));

    $('#lnkDersAdi').editable(
    {
        pk: function () {
            return $("#spnDersID").attr("data-DersID")
        },

        name: 'DersAdi',

        url: '/Ajax/Ders/DersAyarKaydet',

        display: function (value) {
            $(this).text(value + '');
        },

        success: function (msg) {

            MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);

        }
    });


    $('#lnkDersAdresKodu').editable(
    {
        pk: function () {
            return $("#spnDersID").attr("data-DersID")
        },

        name: '',

        url: '/Ajax/Ders/DersAdresKoduKaydet',

        display: function (value) {
            $(this).text(value + '');
        },

        success: function (msg) {
            $('#lnkDersAdresKodu').html(msg);
             MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);

        }
    });

    $('#lnkAciklama').editable({
        pk: function () {
            return $("#spnDersID").attr("data-DersID")
        },

        name: 'Aciklama',

        url: '/Ajax/Ders/DersAyarKaydet',

        display: function (value) {
            $(this).text(value + '');
        },

        success: function (msg) {

             MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);

        }
    });


    $('#cmbKabulSekli').selectize(
    {

        onItemAdd:
            function (data, $item) {
                var alan = 'KabulSekli';
                var DersID = $("#spnDersID").attr("data-DersID");
                var deger = data;
               
                $.ajax({
                    type: 'POST',
                    url: '/Ajax/Ders/DersAyarKaydet',
                    data: "pk=" + DersID + "&name=" + alan + '&value=' + deger,
                    success: function (msg) {
                         
                         MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);
                    },
                    error: function (msg) {
                         
                        HataMesaji(mesajlar.islemsirasindahata);
                    }
                });
               
            }
    }
    );


    $('#cmbAramalardaGoster').selectize(
    {

        onItemAdd:
            function (data, $item) {
                var alan = 'AramalardaGoster';
                var DersID = $("#spnDersID").attr("data-DersID");
                var deger = data;
               
                $.ajax({
                    type: 'POST',
                    url: '/Ajax/Ders/DersAyarKaydet',
                    data: "pk=" + DersID + "&name=" + alan + '&value=' + deger,
                    success: function (msg) {
                          
                         MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);
                    },
                    error: function (msg) {
                          
                         HataMesaji(mesajlar.islemsirasindahata);
                    }
                });
              
            }
    });

    $('#cmbArsivlendi').selectize(
    {

        onItemAdd:
            function (data, $item) {
                var alan = 'Arsivlendi';
                var DersID = $("#spnDersID").attr("data-DersID");
                var deger = data;
               
                $.ajax({
                    type: 'POST',
                    url: '/Ajax/Ders/DersAyarKaydet',
                    data: "pk=" + DersID + "&name=" + alan + '&value=' + deger,
                    success: function (msg) {
                         
                         MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);
                    },
                    error: function (msg) {
                         
                        HataMesaji(mesajlar.islemsirasindahata);
                    }
                });
               
            }
    });


    $('#cmbHaftalikSaat').selectize(
    {

        onItemAdd:
            function (data, $item) {
                var alan = 'HaftalikSaat';
                var DersID = $("#spnDersID").attr("data-DersID");
                var deger = data;
               
                $.ajax({
                    type: 'POST',
                    url: '/Ajax/Ders/DersAyarKaydet',
                    data: "pk=" + DersID + "&name=" + alan + '&value=' + deger,
                    success: function (msg) {
                         
                        MesajKutusu(mesajlar.islemtamam, mesajlar.dersayarlarikaydedildi);
                    },
                    error: function (msg) {
                         
                        HataMesaji(mesajlar.islemsirasindahata);
                    }
                });
               
            }
    });



    var $ogrenciler = $('#txtOgrenciler').selectize({

        valueField: 'userID',
        labelField: 'adsoyad',
        searchField: 'adsoyad',
        options: [],
        create: false,
        render: {
            option: function (item, escape) {

                return '<div class="media">' +
                            '<a class="pull-left" href="#">' +
                            '<img class="media-object img-circle" src="http://bulutders.blob.core.windows.net/profilresimleri/' + escape(item.Avatar) + '" width="48" height="48">' +
                            '</a>' +

                            '<div class="media-body">' +
                                '<h5 class="media-heading">' + escape(item.adsoyad) + '</h5>' +

                            '</div>' +
                            '</div>';

            }
        },

        load: function (query, callback) {
            if (!query.length) return callback();

            $.ajax({
                url: '/Ajax/JsonKisiListesi.cshtml',
                data: {
                    sorgu: query
                },
                dataType: 'json',
                type: 'GET',
                error: function () {
                    alert('hata');
                    callback();
                },
                success: function (res) {
                    callback(res);
                }
            });
        },

        onItemAdd:
            function (data, $item) {

                var DersID = $("#spnDersID").attr("data-DersID");
                var control = $ogrenciler[0].selectize;

                var UserID = control.getValue();
                var ogrenciAdiSoyadi = control.getItem(control.getValue()).text();



                $.ajax({
                    type: 'POST',
                    url: '/Ajax/DersTakip/ErisimIzniVer',
                    data: "DersID=" + DersID + "&UserID=" + UserID,
                    success: function (msg) {
                        var eHtml = String.format('<tr><td>{0}</td><td><button class="btn btn-danger erisimiDurdur">{1}</button></td></tr>', ogrenciAdiSoyadi, mesajlar.durdur);
                        $('#lstOnayliOgrenciler > tbody').prepend(eHtml);
                        control.clear();
                    },
                    error: function (msg) {
                         HataMesaji(mesajlar.beklenmeyenhata);
                    }
                });



            }

    });

});