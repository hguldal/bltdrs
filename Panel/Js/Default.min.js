$(document).ready(function () {

    $('body').on('click', '.btnAktiviteSil', function () {

        var aktiviteID = $(this).attr('data-AktiviteID');
        var satir = $(this).closest('tr');
        if (confirm(mesajlar.aktivitesilinecek)) {


            $.ajax({
                type: 'POST',
                url: '/Ajax/Aktivite/Sil',
                data: "AktiviteID=" + aktiviteID,
                success: function (msg) {
                    $(satir).animate({ backgroundColor: 'gray' }, 150).fadeOut(150, function () {
                        $(satir).remove();
                    });

                },
                error: function (msg) {
                    HataMesaji(mesajlar.silinmeesnasindahata);
                }
            });
        }

    });

    $('body').on('click', '.AktiviteBegen', function () {

        var AktiviteID = $(this).attr('data-AktiviteID');
        var dugme = $(this);

        $.ajax({
            type: 'POST',
            url: '/Ajax/Aktivite/Begen',
            data: "AktiviteID=" + AktiviteID,
            success: function (msg) {

                dugme.removeClass('AktiviteBegen');
                dugme.addClass('AktiviteBegenmektenVazgec');

                dugme.html('<i class="fa fa-thumbs-o-down"></i> ' + mesajlar.begenmektenvazgec);

            },
            error: function (msg) {
                HataMesaji(mesajlar.islemsirasindahata);
            }
        });



    });

    $('body').on('click', '.btnGoruntuleyenleriGoster', function () {

        var aktiviteID = $(this).attr('data-AktiviteID');

        $.ajax({
            type: 'POST',
            url: '/Ajax/Aktivite/JsonGoruntuleyenler',
            data: "AktiviteID=" + aktiviteID,
            dataType: "json",
            success: function (msg) {

                for (var i = 0; i < msg.length; i++) {
                    var html = '<span><img src="http://bulutders.blob.core.windows.net/profilresimleri/' + msg[i].Avatar + '" class="img-rounded" style="width:48px;height: 48px"> <a href="/Hesap/Profil?UserID=' + msg[i].UserID + '"> ' + msg[i].Ad + ' ' + msg[i].Soyad + '</a></span>'
                    $('#tableKisiListesi').append('<tr><td>' + html + '</td></tr>');
                }
                UIUnBlock();
                $('#modalKisiDetaylari').modal('show');

            },
            error: function (msg) {
                HataMesaji(mesajlar.islemsirasindahata);
            }
        });


    });
    $('body').on('click', '.btnBegenenleriGoster', function () {

        var aktiviteID = $(this).attr('data-AktiviteID');

        $.ajax({
            type: 'POST',
            url: '/Ajax/Aktivite/JsonBegenenler',
            data: "AktiviteID=" + aktiviteID,
            dataType: "json",
            success: function (msg) {

                for (var i = 0; i < msg.length; i++) {
                    var html = '<span><img src="http://bulutders.blob.core.windows.net/profilresimleri/' + msg[i].Avatar + '" class="img-rounded" style="width:48px;height: 48px"> <a href="/Hesap/Profil?UserID=' + msg[i].UserID + '"> ' + msg[i].Ad + ' ' + msg[i].Soyad + '</a></span>'
                    $('#tableKisiListesi').append('<tr><td>' + html + '</td></tr>');
                }
                UIUnBlock();
                $('#modalKisiDetaylari').modal('show');

            },
            error: function (msg) {
                HataMesaji(mesajlar.islemsirasindahata);
            }
        });



    });



    $('#modalKisiDetaylari').on('hide.bs.modal', function (e) {
        $('#tableKisiListesi').empty();

    });
    $('body').on('click', '.AktiviteBegenmektenVazgec', function () {

        var AktiviteID = $(this).attr('data-AktiviteID');
        var dugme = $(this);

        $.ajax({
            type: 'POST',
            url: '/Ajax/Aktivite/BegenmektenVazgec',
            data: "AktiviteID=" + AktiviteID,
            success: function (msg) {

                dugme.addClass('AktiviteBegen');
                dugme.removeClass('AktiviteBegenmektenVazgec');

                dugme.html('<i class="fa fa-thumbs-o-up"></i> ' + mesajlar.begen);

            },
            error: function (msg) {
                HataMesaji(mesajlar.islemsirasindahata);
            }
        });



    });


    function AktiviteJsonToHtml(objAktivite) {

        var dersAdiHtml = '';

        if (objAktivite.UI_DersAdi != null) {
            dersAdiHtml = '<a href="' + objAktivite.URL + '">' + objAktivite.UI_DersAdi + ' dersinde</a>';
        }

        var ilaveMetinHtml = '';
        if (objAktivite.IlaveMetin != null) {
            ilaveMetinHtml = '<em><br>' + objAktivite.IlaveMetin + '</em>';
        }

        var aktiviteBegenHtml = '';


        if (objAktivite.UI_AktiviteBegendi == 0) {
            aktiviteBegenHtml = '<button type="button" class="btn btn-link btn-xs AktiviteBegen" data-AktiviteID="' + objAktivite.AktiviteID + '"><i class="fa fa-thumbs-o-up"></i> ' + mesajlar.begen + '</button>';
        }
        else {
            aktiviteBegenHtml = '<button type="button" class="btn btn-link btn-xs AktiviteBegenmektenVazgec" data-AktiviteID="' + objAktivite.AktiviteID + '"> <i class="fa fa-thumbs-o-down"></i> ' + mesajlar.begenmektenvazgec + ' </button>';
        }

        var silmeDugmesiHtml = '';

        if (objAktivite.UI_SilmeDugmesi == 1) {
            silmeDugmesiHtml = '<button class="btn btn-danger btnAktiviteSil btn-xs" data-AktiviteID="' + objAktivite.AktiviteID + '"><i class="fa fa-remove"></i></button>';
        }

        var html = ' <tr>' +
                    '<td class="text-center text-' + objAktivite.Renk + '"><span>' +
                            '<i class="fa ' + objAktivite.Ikon + ' fa-fw fa-2x"></i>  </span>' +
                            '<br>' +
                            '<h4><i class="fa fa-thumbs-o-up" data-toggle="tooltip" data-placement="top" title="' + mesajlar.begenisayisi + '"></i> ' + objAktivite.UI_BegeniSayisi + ' </h4>' +
                            '<br>' +
                            '<h4><i class="fa fa-eye" data-toggle="tooltip" data-placement="top" title="' + mesajlar.begenisayisi + '"></i> ' + objAktivite.UI_AktiviteOkundu + ' </h4>' +
                    '</td>' +

                    '<td>' +

        ProfilKucukKunyeHTML(objAktivite.UserID, objAktivite.UI_KisiAvatar, objAktivite.UI_KisiUnvan, objAktivite.UI_KisiAd, objAktivite.UI_KisiSoyad, objAktivite.UI_KisiOnayli) +

                        dersAdiHtml +

                        '</div><a href="' + objAktivite.URL + '">' + objAktivite.Metin + '</a> <br>' +

                        ilaveMetinHtml +

                        '<br><br>' +

                        aktiviteBegenHtml +
                    '</td>' +

                    '<td class="text-right">' + objAktivite.UI_GorunenTarih + '</td><td>' +

                        silmeDugmesiHtml +
                    '</td></tr>';
        console.log(html);
        return html;
    }

    $('#btnOncekiaktiviteler').click(function () {
        OncekiAktiviteler();
    });

    function OncekiAktiviteler() {

        if ($('#btnOncekiaktiviteler').attr('disabled') == 'disabled') {
            return false;
        }

        var sonAktiviteID = $('#btnOncekiaktiviteler').attr('data-SonAktiviteID');

        $.ajax({
            type: 'POST',
            url: '/Ajax/Aktivite/JsonAktiviteler',
            data: "SonAktiviteID=" + sonAktiviteID,
            dataType: "json",
            success: function (msg) {
                if (msg.Aktiviteler.length == 0 || msg.Aktiviteler.length < 25) {
                    $('#btnOncekiaktiviteler').attr('disabled', 'disabled');
                }
                for (var i = 0; i < msg.Aktiviteler.length; i++) {
                    $('#tabloAktiviteler > tbody').append(AktiviteJsonToHtml(msg.Aktiviteler[i]));
                    $('#btnOncekiaktiviteler').attr('data-SonAktiviteID', msg.Aktiviteler[i].AktiviteID);
                }
                $("html, body").animate({ scrollTop: $(document).height() }, 1000);

            },
            error: function (msg) {

                HataMesaji(mesajlar.islemsirasindahata);
            }
        });

    }

});